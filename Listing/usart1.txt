; generated by ARM C/C++ Compiler, 5.03 [Build 76]
; commandline ArmCC [--c99 --list --debug -c --asm --interleave -o..\output\usart1.o --asm_dir=..\Listing\ --list_dir=..\Listing\ --depend=..\output\usart1.d --cpu=Cortex-M3 --apcs=interwork -O0 -I..\BSP -I..\CMSIS -I..\Lib\inc -I..\User -I"E:\Program Files\keil for arm4.7\ARM\RV31\INC" -I"E:\Program Files\keil for arm4.7\ARM\CMSIS\Include" -I"E:\Program Files\keil for arm4.7\ARM\Inc\ST\STM32F10x" -D__MICROLIB -DUSE_STDPERIPH_DRIVER -DSTM32F10X_HD --omf_browse=..\output\usart1.crf ..\BSP\USART1.c]
                          THUMB

                          AREA ||.text||, CODE, READONLY, ALIGN=2

                  USART1_Config PROC
;;;20      */
;;;21     void USART1_Config(void)
000000  b500              PUSH     {lr}
;;;22     {
000002  b085              SUB      sp,sp,#0x14
;;;23     	GPIO_InitTypeDef GPIO_InitStructure;
;;;24     	USART_InitTypeDef USART_InitStructure;
;;;25     	
;;;26     	/* config USART1 clock */
;;;27     	RCC_APB2PeriphClockCmd(RCC_APB2Periph_USART1 | RCC_APB2Periph_GPIOA, ENABLE);
000004  2101              MOVS     r1,#1
000006  f2440004          MOV      r0,#0x4004
00000a  f7fffffe          BL       RCC_APB2PeriphClockCmd
;;;28     	
;;;29     	/* USART1 GPIO config */
;;;30     	/* Configure USART1 Tx (PA.09) as alternate function push-pull */
;;;31     	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_9;
00000e  f44f7000          MOV      r0,#0x200
000012  f8ad0010          STRH     r0,[sp,#0x10]
;;;32     	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_AF_PP;
000016  2018              MOVS     r0,#0x18
000018  f88d0013          STRB     r0,[sp,#0x13]
;;;33     	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;
00001c  2003              MOVS     r0,#3
00001e  f88d0012          STRB     r0,[sp,#0x12]
;;;34     	GPIO_Init(GPIOA, &GPIO_InitStructure);    
000022  a904              ADD      r1,sp,#0x10
000024  4848              LDR      r0,|L1.328|
000026  f7fffffe          BL       GPIO_Init
;;;35     	/* Configure USART1 Rx (PA.10) as input floating */
;;;36     	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10;
00002a  f44f6080          MOV      r0,#0x400
00002e  f8ad0010          STRH     r0,[sp,#0x10]
;;;37     	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN_FLOATING;
000032  2004              MOVS     r0,#4
000034  f88d0013          STRB     r0,[sp,#0x13]
;;;38     	GPIO_Init(GPIOA, &GPIO_InitStructure);
000038  a904              ADD      r1,sp,#0x10
00003a  4843              LDR      r0,|L1.328|
00003c  f7fffffe          BL       GPIO_Init
;;;39     	
;;;40     	/* USART1 mode config */
;;;41     	USART_InitStructure.USART_BaudRate = 115200;
000040  f44f30e1          MOV      r0,#0x1c200
000044  9000              STR      r0,[sp,#0]
;;;42     	USART_InitStructure.USART_WordLength = USART_WordLength_8b;
000046  2000              MOVS     r0,#0
000048  f8ad0004          STRH     r0,[sp,#4]
;;;43     	USART_InitStructure.USART_StopBits = USART_StopBits_1;
00004c  f8ad0006          STRH     r0,[sp,#6]
;;;44     	USART_InitStructure.USART_Parity = USART_Parity_No ;
000050  f8ad0008          STRH     r0,[sp,#8]
;;;45     	USART_InitStructure.USART_HardwareFlowControl = USART_HardwareFlowControl_None;
000054  f8ad000c          STRH     r0,[sp,#0xc]
;;;46     	USART_InitStructure.USART_Mode = USART_Mode_Rx | USART_Mode_Tx;
000058  200c              MOVS     r0,#0xc
00005a  f8ad000a          STRH     r0,[sp,#0xa]
;;;47     	
;;;48     	USART_Init(USART1, &USART_InitStructure);
00005e  4669              MOV      r1,sp
000060  483a              LDR      r0,|L1.332|
000062  f7fffffe          BL       USART_Init
;;;49     //	USART_ITConfig(USART1, USART_IT_RXNE, ENABLE);
;;;50     	
;;;51     	USART_Cmd(USART1, ENABLE);
000066  2101              MOVS     r1,#1
000068  4838              LDR      r0,|L1.332|
00006a  f7fffffe          BL       USART_Cmd
;;;52     }
00006e  b005              ADD      sp,sp,#0x14
000070  bd00              POP      {pc}
;;;53     
                          ENDP

                  NVIC_Configuration PROC
;;;54     
;;;55     void NVIC_Configuration(void)
000072  b508              PUSH     {r3,lr}
;;;56     {
;;;57     	NVIC_InitTypeDef NVIC_InitStructure; 
;;;58     	/* Configure the NVIC Preemption Priority Bits */  
;;;59     	NVIC_PriorityGroupConfig(NVIC_PriorityGroup_0);
000074  f44f60e0          MOV      r0,#0x700
000078  f7fffffe          BL       NVIC_PriorityGroupConfig
;;;60     	
;;;61     	/* Enable the USARTy Interrupt */
;;;62     	NVIC_InitStructure.NVIC_IRQChannel = USART1_IRQn;	 
00007c  2025              MOVS     r0,#0x25
00007e  f88d0000          STRB     r0,[sp,#0]
;;;63     	NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
000082  2000              MOVS     r0,#0
000084  f88d0001          STRB     r0,[sp,#1]
;;;64     	NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
000088  f88d0002          STRB     r0,[sp,#2]
;;;65     	NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
00008c  2001              MOVS     r0,#1
00008e  f88d0003          STRB     r0,[sp,#3]
;;;66     	NVIC_Init(&NVIC_InitStructure);
000092  4668              MOV      r0,sp
000094  f7fffffe          BL       NVIC_Init
;;;67     }
000098  bd08              POP      {r3,pc}
;;;68     
                          ENDP

                  fputc PROC
;;;77      */
;;;78     int fputc(int ch, FILE *f)
00009a  b570              PUSH     {r4-r6,lr}
;;;79     {
00009c  4604              MOV      r4,r0
00009e  460d              MOV      r5,r1
;;;80     	/* ½«PrintfÄÚÈÝ·¢Íù´®¿Ú */
;;;81     	USART_SendData(USART1, (unsigned char) ch);
0000a0  b2e1              UXTB     r1,r4
0000a2  482a              LDR      r0,|L1.332|
0000a4  f7fffffe          BL       USART_SendData
;;;82     	while (!(USART1->SR & USART_FLAG_TXE));
0000a8  bf00              NOP      
                  |L1.170|
0000aa  4828              LDR      r0,|L1.332|
0000ac  8800              LDRH     r0,[r0,#0]
0000ae  f0100f80          TST      r0,#0x80
0000b2  d0fa              BEQ      |L1.170|
;;;83     	
;;;84     	return (ch);
0000b4  4620              MOV      r0,r4
;;;85     }
0000b6  bd70              POP      {r4-r6,pc}
;;;86     
                          ENDP

                  NVIC_Config PROC
;;;88     
;;;89     static void NVIC_Config(void)
0000b8  b508              PUSH     {r3,lr}
;;;90     {
;;;91       NVIC_InitTypeDef NVIC_InitStructure;
;;;92       
;;;93       /* Configure one bit for preemption priority */
;;;94       NVIC_PriorityGroupConfig(NVIC_PriorityGroup_0);
0000ba  f44f60e0          MOV      r0,#0x700
0000be  f7fffffe          BL       NVIC_PriorityGroupConfig
;;;95       
;;;96       /* ÅäÖÃP[A|B|C|D|E]0ÎªÖÐ¶ÏÔ´ */
;;;97       NVIC_InitStructure.NVIC_IRQChannel = DMA1_Channel5_IRQn;
0000c2  200f              MOVS     r0,#0xf
0000c4  f88d0000          STRB     r0,[sp,#0]
;;;98       NVIC_InitStructure.NVIC_IRQChannelPreemptionPriority = 0;
0000c8  2000              MOVS     r0,#0
0000ca  f88d0001          STRB     r0,[sp,#1]
;;;99       NVIC_InitStructure.NVIC_IRQChannelSubPriority = 0;
0000ce  f88d0002          STRB     r0,[sp,#2]
;;;100      NVIC_InitStructure.NVIC_IRQChannelCmd = ENABLE;
0000d2  2001              MOVS     r0,#1
0000d4  f88d0003          STRB     r0,[sp,#3]
;;;101      NVIC_Init(&NVIC_InitStructure);
0000d8  4668              MOV      r0,sp
0000da  f7fffffe          BL       NVIC_Init
;;;102    }
0000de  bd08              POP      {r3,pc}
;;;103    
                          ENDP

                  DMA_Usart1_Config PROC
;;;104    void DMA_Usart1_Config(void)
0000e0  b500              PUSH     {lr}
;;;105    {
0000e2  b08b              SUB      sp,sp,#0x2c
;;;106        DMA_InitTypeDef DMA_InitStructure;
;;;107    
;;;108    	RCC_AHBPeriphClockCmd(RCC_AHBPeriph_DMA1, ENABLE);	//¿ªÆôDMAÊ±ÖÓ
0000e4  2101              MOVS     r1,#1
0000e6  4608              MOV      r0,r1
0000e8  f7fffffe          BL       RCC_AHBPeriphClockCmd
;;;109    	NVIC_Config();	   			//ÅäÖÃDMAÖÐ¶Ï
0000ec  f7fffffe          BL       NVIC_Config
;;;110    
;;;111     	/*ÉèÖÃDMAÔ´£ºÄÚ´æµØÖ·&´®¿ÚÊý¾Ý¼Ä´æÆ÷µØÖ·*/
;;;112        DMA_InitStructure.DMA_PeripheralBaseAddr = (u32)USART1_DR_Base;	   
0000f0  4816              LDR      r0,|L1.332|
0000f2  1d00              ADDS     r0,r0,#4
0000f4  9000              STR      r0,[sp,#0]
;;;113    
;;;114    	/*ÄÚ´æµØÖ·(Òª´«ÊäµÄ±äÁ¿µÄÖ¸Õë)*/
;;;115        DMA_InitStructure.DMA_MemoryBaseAddr = (u32)ReadBuffer;
0000f6  4816              LDR      r0,|L1.336|
0000f8  9001              STR      r0,[sp,#4]
;;;116    	
;;;117    	/*·½Ïò£º´ÓÍâÉèµ½ÄÚ´æ*/		
;;;118        DMA_InitStructure.DMA_DIR = DMA_DIR_PeripheralSRC;	
0000fa  2000              MOVS     r0,#0
0000fc  9002              STR      r0,[sp,#8]
;;;119    	
;;;120    	/*´«Êä´óÐ¡DMA_BufferSize=SENDBUFF_SIZE*/	
;;;121        DMA_InitStructure.DMA_BufferSize = READBUFF_SIZE;
0000fe  2017              MOVS     r0,#0x17
000100  9003              STR      r0,[sp,#0xc]
;;;122    	
;;;123    	/*ÍâÉèµØÖ·²»Ôö*/	    
;;;124        DMA_InitStructure.DMA_PeripheralInc = DMA_PeripheralInc_Disable; 
000102  2000              MOVS     r0,#0
000104  9004              STR      r0,[sp,#0x10]
;;;125    	
;;;126    	/*ÄÚ´æµØÖ·×ÔÔö*/
;;;127        DMA_InitStructure.DMA_MemoryInc = DMA_MemoryInc_Enable;	
000106  2080              MOVS     r0,#0x80
000108  9005              STR      r0,[sp,#0x14]
;;;128    	
;;;129    	/*ÍâÉèÊý¾Ýµ¥Î»*/	
;;;130        DMA_InitStructure.DMA_PeripheralDataSize = DMA_PeripheralDataSize_Byte;
00010a  2000              MOVS     r0,#0
00010c  9006              STR      r0,[sp,#0x18]
;;;131    	
;;;132    	/*ÄÚ´æÊý¾Ýµ¥Î» 8bit*/
;;;133        DMA_InitStructure.DMA_MemoryDataSize = DMA_MemoryDataSize_Byte;	 
00010e  9007              STR      r0,[sp,#0x1c]
;;;134    	
;;;135    	/*DMAÄ£Ê½£ºÒ»´Î´«Êä£¬Ñ­»·*/
;;;136        DMA_InitStructure.DMA_Mode = DMA_Mode_Circular;	 
000110  2020              MOVS     r0,#0x20
000112  9008              STR      r0,[sp,#0x20]
;;;137    	
;;;138    	/*ÓÅÏÈ¼¶£ºÖÐ*/	
;;;139        DMA_InitStructure.DMA_Priority = DMA_Priority_VeryHigh;  
000114  f44f5040          MOV      r0,#0x3000
000118  9009              STR      r0,[sp,#0x24]
;;;140    	
;;;141    	/*½ûÖ¹ÄÚ´æµ½ÄÚ´æµÄ´«Êä	*/
;;;142        DMA_InitStructure.DMA_M2M = DMA_M2M_Disable;
00011a  2000              MOVS     r0,#0
00011c  900a              STR      r0,[sp,#0x28]
;;;143    	
;;;144    	/*ÅäÖÃDMA1µ9Í¨µÀ*/		   
;;;145        DMA_Init(DMA1_Channel5, &DMA_InitStructure); 
00011e  4669              MOV      r1,sp
000120  480c              LDR      r0,|L1.340|
000122  f7fffffe          BL       DMA_Init
;;;146    		
;;;147    	USART_DMACmd(USART1,USART_DMAReq_Rx,ENABLE);
000126  2201              MOVS     r2,#1
000128  2140              MOVS     r1,#0x40
00012a  4808              LDR      r0,|L1.332|
00012c  f7fffffe          BL       USART_DMACmd
;;;148    	DMA_ITConfig(DMA1_Channel5,DMA_IT_TC,ENABLE);  //ÅäÖÃDMA·¢ËÍÍê³Éºó²úÉúÖÐ¶Ï
000130  2201              MOVS     r2,#1
000132  2102              MOVS     r1,#2
000134  4807              LDR      r0,|L1.340|
000136  f7fffffe          BL       DMA_ITConfig
;;;149    	DMA_Cmd(DMA1_Channel5,ENABLE);					//Ê¹ÄÜDMA	
00013a  2101              MOVS     r1,#1
00013c  4805              LDR      r0,|L1.340|
00013e  f7fffffe          BL       DMA_Cmd
;;;150    }
000142  b00b              ADD      sp,sp,#0x2c
000144  bd00              POP      {pc}
                          ENDP

000146  0000              DCW      0x0000
                  |L1.328|
                          DCD      0x40010800
                  |L1.332|
                          DCD      0x40013800
                  |L1.336|
                          DCD      ReadBuffer
                  |L1.340|
                          DCD      0x40020058

                          AREA ||.bss||, DATA, NOINIT, ALIGN=0

                  ReadBuffer
                          %        23
